# Changelog

<!-- Generated by Claude Code on 2026-01-17 - Based on git repository history -->

All notable changes to the Monoliet Client Portal project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project follows semantic versioning principles.

---

## [Unreleased]

### Added
- Comprehensive documentation suite:
  - ARCHITECTURE.md - System architecture and design patterns
  - API_REFERENCE.md - Complete API endpoint documentation
  - CONTRIBUTING.md - Development guidelines and workflow
  - DEPLOYMENT.md - Production deployment guide
  - CHANGELOG.md - Version history

---

## [1.0.0] - 2026-01-17

### Added (Latest Updates)

#### Admin Panel Enhancements (2026-01-17)
- **Commit:** `ed23a7b` - admin-settings
- Added PortalSettings singleton model for system-wide configuration
- Added n8n connection configuration and status tracking
- Added general settings (company name, support email, max clients)
- Added notification settings (Slack webhook, email notifications)
- Implemented singleton pattern to ensure only one settings instance exists

**Code References:**
- clients/models.py:269-353 (PortalSettings model)
- Admin configuration updates

#### Admin Overview Dashboard (2026-01-16)
- **Commit:** `1b2fe77` - admin-panel overview
- Created custom admin dashboard with statistics and metrics
- Added admin_views.py with comprehensive overview functionality
- Implemented admin index template with charts and insights
- Added quick links to key admin sections

**Code References:**
- clients/admin_views.py (dashboard view)
- clients/templates/admin/index.html (dashboard template)

### Added (Major Features)

#### Frontend Overhaul (2026-01-14)
- **Commit:** `31a49aa` - Claude front-end overhaul
- Redesigned client portal interface with Tailwind CSS
- Created responsive dashboard with real-time statistics
- Added workflow management interface with success rates
- Created invoice management view with filtering
- Implemented support ticket system UI
- Added base template with consistent navigation
- Mobile-responsive design throughout

**Code References:**
- clients/templates/clients/dashboard.html
- clients/templates/clients/workflows.html
- clients/templates/clients/invoices.html
- clients/templates/clients/support.html
- clients/templates/clients/base.html

#### Authentication and User Management (2026-01-14)
- **Commit:** `23d5605`, `6efba19` - Logout fixes
- Fixed logout functionality and redirect flow
- Added logout confirmation page
- Improved authentication error handling
- Updated login page styling

**Code References:**
- clients/templates/clients/logout_confirm.html
- clients/web_views.py (logout view)

#### Client Portal Views (2026-01-13)
- **Commit:** `4ed4297` - claude client view fix
- Fixed client profile association logic
- Added "no client" error page for users without client assignment
- Improved client data filtering and permissions

**Code References:**
- clients/templates/clients/no_client.html
- clients/web_views.py (client filtering logic)

#### Core System Implementation (2026-01-13)
- **Commit:** `868c200` - Fix authentication flow and admin panel errors
- Implemented token authentication system
- Fixed admin panel registration issues
- Added custom authentication views with user info
- Improved error handling in API endpoints

**Code References:**
- clients/views.py:371-409 (CustomAuthToken, logout_view)

#### Environment Configuration (2026-01-13)
- **Commit:** `ba48165` - env.example file mod
- Created comprehensive .env.example template
- Added security key generation instructions
- Documented all required environment variables
- Added CSRF trusted origins configuration

**Code References:**
- .env.example:1-36

#### Database and Production Setup (2026-01-12)
- **Commit:** `2257406` - Add database migrations and production configurations
- Created initial database migrations for all 8 models
- Configured production-ready settings
- Added PostgreSQL database setup
- Implemented UUID primary keys across all models
- Set up security middleware and CORS

**Code References:**
- clients/migrations/0001_initial.py
- portal/settings.py:197-207 (production security settings)

### Initial Release (2026-01-12)

#### Complete Application Framework (2026-01-12)
- **Commit:** `82a26e7` - Second commit: Claude
- Implemented all 8 database models (Client, Workflow, APICredential, Execution, Invoice, SupportTicket, ClientProfile, PortalSettings)
- Created REST API with Django REST Framework
- Implemented custom permission system (6 permission classes)
- Added email notification system via Django signals
- Created utility functions (encryption, n8n API client, statistics)
- Implemented 4 management commands for automation
- Added web views for client portal
- Created Django admin customizations
- Implemented API serializers with admin/client variations

**Code References:**
- clients/models.py (all models)
- clients/views.py (API ViewSets)
- clients/web_views.py (web portal views)
- clients/serializers.py (DRF serializers)
- clients/permissions.py (custom permissions)
- clients/signals.py (email notifications)
- clients/utils.py (utilities and n8n client)
- clients/admin.py (admin customizations)
- clients/management/commands/ (automation commands)

#### Project Foundation (2026-01-11)
- **Commit:** `6db6809` - Initial commit: Project setup
- Created Django 5.0.1 project structure
- Set up Docker containerization with docker-compose
- Configured PostgreSQL 15 database
- Added Python dependencies (requirements.txt)
- Configured Gunicorn and WhiteNoise for production
- Set up CORS headers for API access
- Created .gitignore for Python/Django projects
- Added Dockerfile with Python 3.11
- Configured Django settings with environment variables

**Code References:**
- portal/settings.py (Django configuration)
- docker-compose.yml (container orchestration)
- Dockerfile (Django container)
- requirements.txt (Python dependencies)
- .gitignore (version control exclusions)

---

## Project Components

### Database Models (8 Total)

1. **Client** - Client company information and billing
   - UUID primary key
   - Status tracking (active/paused/churned)
   - Billing information (setup fee, monthly fee, billing cycle)
   - Plan tier and contact details

2. **Workflow** - n8n workflow tracking
   - Links to Client
   - n8n workflow ID and URL
   - Status (active/paused/error)
   - Execution count and last execution timestamp

3. **APICredential** - Encrypted third-party credentials
   - Fernet encryption for sensitive data
   - Service name and credential type
   - Status tracking (active/expired/invalid)

4. **Execution** - Daily execution statistics
   - Per-workflow execution counts
   - Success/error tracking
   - Daily aggregation with unique constraint

5. **Invoice** - Billing and payment tracking
   - Auto-generated invoice numbers (INV-YYYY-XXX)
   - Status (pending/paid/overdue)
   - Stripe integration ready

6. **SupportTicket** - Customer support management
   - Priority levels (low/medium/high)
   - Status tracking (open/in_progress/resolved)
   - Resolution timestamps

7. **ClientProfile** - User-to-client linking
   - Extends Django User model
   - Enables client portal access
   - One-to-one with User, many-to-one with Client

8. **PortalSettings** - System configuration (Singleton)
   - n8n connection settings
   - General portal settings
   - Notification configuration

**Code Reference:** clients/models.py

### REST API Endpoints

**Authentication:**
- POST `/api/auth/token/` - Obtain token
- POST `/api/auth/logout/` - Revoke token

**Clients:**
- GET `/api/clients/` - List clients (admin only)
- GET `/api/clients/me/` - Get current user's client
- GET `/api/clients/{id}/` - Get client details
- POST/PUT/PATCH/DELETE `/api/clients/{id}/` - CRUD operations (admin only)

**Workflows:**
- GET/POST `/api/workflows/` - List/create workflows
- GET/PUT/PATCH/DELETE `/api/workflows/{id}/` - CRUD operations
- PATCH `/api/workflows/{id}/activate/` - Activate/pause workflow

**Executions:**
- GET/POST `/api/executions/` - List/create execution records
- GET `/api/executions/stats/` - Aggregated statistics

**Invoices:**
- GET/POST `/api/invoices/` - List/create invoices
- GET/PUT/PATCH/DELETE `/api/invoices/{id}/` - CRUD operations
- GET `/api/invoices/{id}/download/` - Download PDF (placeholder)

**Support Tickets:**
- GET/POST `/api/support-tickets/` - List/create tickets
- GET/PATCH/DELETE `/api/support-tickets/{id}/` - Operations

**API Credentials:**
- GET/POST `/api/credentials/` - List/create credentials
- GET/PUT/PATCH/DELETE `/api/credentials/{id}/` - CRUD operations

**Code Reference:** clients/views.py, clients/urls.py

### Management Commands

1. **sync_n8n_executions** - Sync execution data from n8n
2. **send_invoice_reminders** - Payment reminder emails
3. **check_workflow_health** - Monitor workflow health
4. **create_sample_data** - Generate test data

**Code Reference:** clients/management/commands/

### Permission Classes

1. **IsAdminUser** - Admin-only access
2. **IsClientOwner** - Client data isolation
3. **IsClientUser** - Client profile verification
4. **ReadOnly** - Read-only access
5. **IsAdminOrReadOnly** - Conditional write access
6. **CanCreateSupportTicket** - Ticket creation permissions

**Code Reference:** clients/permissions.py

### Email Notifications

Automatic emails sent via Django signals:
- New support ticket → Client & admin notification
- Ticket resolved → Client notification
- New invoice → Client notification
- Workflow error → Admin alert

**Code Reference:** clients/signals.py

---

## Technology Stack

### Backend
- Django 5.0.1
- Django REST Framework 3.14.0
- Python 3.11
- PostgreSQL 15
- Gunicorn 21.2.0

### Security
- Token Authentication (DRF)
- Fernet Encryption (cryptography 42.0.0)
- HTTPS enforcement (production)
- CSRF protection

### Deployment
- Docker & Docker Compose
- WhiteNoise 6.6.0 (static files)
- Nginx Proxy Manager (reverse proxy)

### Frontend
- Tailwind CSS (via CDN)
- Vanilla JavaScript
- Django Templates

**Code Reference:** requirements.txt, docker-compose.yml, Dockerfile

---

## Security Features

- UUID primary keys (no sequential IDs exposed)
- Encrypted API credentials using Fernet
- Role-based permissions (admin vs client users)
- Client data isolation via ClientProfile
- HTTPS enforced in production
- CSRF protection enabled
- SQL injection prevention via Django ORM
- XSS prevention via template auto-escaping
- Secure password hashing (Django PBKDF2)
- Token-based API authentication

**Code Reference:** portal/settings.py:197-207, clients/utils.py:17-62

---

## Contributors

- Andres Mendoza - Lead Developer
- Claude (Anthropic) - AI Assistant for initial implementation

---

## License

Proprietary - Monoliet.cloud

---

## Notes

### Version Numbering

This project uses semantic versioning:
- **MAJOR** version for incompatible API changes
- **MINOR** version for backwards-compatible functionality additions
- **PATCH** version for backwards-compatible bug fixes

### Git Commit History

All commits are available in the git repository:

```bash
git log --all --oneline --decorate
```

### Future Enhancements

Potential additions documented in PROJECT_SUMMARY.md:349-361:
- PDF invoice generation
- Stripe payment integration
- Advanced analytics dashboard
- Webhook support for n8n
- Two-factor authentication
- Activity logs/audit trail
- Bulk operations (CSV import/export)
- Custom email templates
- Mobile app API
- Real-time notifications (WebSockets)

---

**Last Updated:** 2026-01-17
**Current Version:** 1.0.0
**Django Version:** 5.0.1
**Python Version:** 3.11
**PostgreSQL Version:** 15
